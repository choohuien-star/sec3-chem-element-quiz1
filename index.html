<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Personality Quiz</title>
    <style>
        :root {
            --primary: #6366f1;
            --magnesium: #fbbf24;
            --carbon: #10b981;
            --argon: #8b5cf6;
            --copper: #f97316;
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --text: #f8fafc;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: radial-gradient(circle at top left, #1e1b4b, #0f172a);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: absolute;
            width: 300px;
            height: 300px;
            background: var(--primary);
            filter: blur(120px);
            opacity: 0.2;
            top: 10%;
            left: 10%;
            z-index: -1;
        }

        #app {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            position: relative;
        }

        .card {
            background: var(--card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 40px 30px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            transition: all 0.3s ease;
        }

        h1 { 
            font-size: 1.8rem; 
            margin-bottom: 1rem; 
            background: linear-gradient(to right, #818cf8, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        p { line-height: 1.6; color: var(--text-muted); font-size: 1rem; }

        input {
            width: 100%;
            padding: 14px;
            margin: 12px 0;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(15, 23, 42, 0.8);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
            margin-bottom: 14px;
            font-weight: 500;
        }

        .option-btn:hover { 
            border-color: var(--primary); 
            background: rgba(99, 102, 241, 0.1); 
            transform: translateX(5px);
        }

        .hidden { display: none; }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #a855f7);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
        }

        /* Teacher Dashboard Specific Styles */
        .teacher-toggle {
            margin-top: 30px;
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
            text-decoration: underline;
            opacity: 0.6;
        }

        .dashboard-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 300px;
            margin-top: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
        }

        th, td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th { background: rgba(0, 0, 0, 0.3); color: var(--primary); position: sticky; top: 0; }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="app">
    <!-- Screen 1: Welcome & Dashboard Access -->
    <div id="screen-welcome" class="card">
        <div id="student-view">
            <div style="font-size: 4rem; margin-bottom: 10px;">ðŸ§ª</div>
            <h1>Element Discovery</h1>
            <p>Unlock your unique chemical personality for Sec 3 Chemistry!</p>
            <input type="text" id="student-name" placeholder="Enter Full Name" required>
            <input type="text" id="student-class" placeholder="Class (e.g., S3-01)" required>
            <button onclick="startQuiz()">Launch Quiz</button>
            <div class="teacher-toggle" onclick="toggleTeacherLogin()">Teacher Dashboard Login</div>
        </div>

        <div id="teacher-login" class="hidden dashboard-container">
            <h2 style="font-size: 1.2rem; color: var(--primary);">Teacher Access</h2>
            <input type="password" id="admin-pass" placeholder="Enter Password">
            <button onclick="verifyTeacher()">Unlock Dashboard</button>
            <button onclick="toggleTeacherLogin()" style="background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); margin-top: 5px;">Back to Student View</button>
        </div>

        <div id="teacher-dashboard" class="hidden dashboard-container" style="max-width: 100%;">
            <h2 style="font-size: 1.2rem; color: var(--primary);">Live Results</h2>
            <div style="display: flex; gap: 5px;">
                <button onclick="fetchResults()" style="padding: 8px; font-size: 0.8rem;">Refresh</button>
                <button onclick="downloadCSV()" style="padding: 8px; font-size: 0.8rem; background: #10b981;">Export CSV</button>
            </div>
            <div class="table-wrapper">
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>Name</th><th>Class</th><th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Screen 2: Quiz -->
    <div id="screen-quiz" class="card hidden">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p id="question-text" style="font-weight: 700; color: white; font-size: 1.1rem; margin-bottom: 25px;"></p>
        <div id="options-container"></div>
    </div>

    <!-- Screen 3: Results -->
    <div id="screen-result" class="card hidden">
        <div id="result-content">
            <div class="loader"></div>
            <p>Processing electron configurations...</p>
        </div>
        <button onclick="location.reload()" style="margin-top: 25px; background: rgba(255,255,255,0.1); box-shadow: none;">Done</button>
    </div>
</div>

<script>
    // Replace with your Google Apps Script Web App URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzgAIANKnagnJHqITGbCHWyK1NUky78XtJ4HjHgWTEaNPQFlpsJA4sVBdyWp1GRlvz0Dg/exec"; 

    const questions = [
        {
            q: "In Secondary 2 Science, how did you usually approach new topics?",
            options: [
                { t: "I jumped in immediately to try the experiments.", e: "Magnesium" },
                { t: "I carefully noted down all the details and observations.", e: "Carbon" },
                { t: "I listened first to understand the big picture.", e: "Argon" },
                { t: "I liked discussing the ideas with my friends.", e: "Copper" }
            ]
        },
        {
            q: "How do you handle your Chemistry homework?",
            options: [
                { t: "I finish it quickly to see if I got the concepts.", e: "Magnesium" },
                { t: "I organize my answers neatly and check my steps.", e: "Carbon" },
                { t: "I stay calm and work through it even if it's long.", e: "Argon" },
                { t: "I enjoy helping others or comparing answers.", e: "Copper" }
            ]
        },
        {
            q: "When a lab experiment doesn't go as expected, you...",
            options: [
                { t: "Get excited to try a different way right away!", e: "Magnesium" },
                { t: "Analyze the data to find exactly where it shifted.", e: "Carbon" },
                { t: "Remain composed and wait for further instructions.", e: "Argon" },
                { t: "Talk to your group to brainstorm what happened.", e: "Copper" }
            ]
        },
        {
            q: "What's your strongest trait in a group activity?",
            options: [
                { t: "Initiating action and keeping energy high.", e: "Magnesium" },
                { t: "Reliability and making sure we follow the rubric.", e: "Carbon" },
                { t: "Being the 'anchor' who keeps everyone focused.", e: "Argon" },
                { t: "Facilitating communication and harmony.", e: "Copper" }
            ]
        },
        {
            q: "When facing a very difficult challenge problem...",
            options: [
                { t: "I love the thrill of trying to crack it.", e: "Magnesium" },
                { t: "I break it down into smaller, logical parts.", e: "Carbon" },
                { t: "I patiently research the theory behind it.", e: "Argon" },
                { t: "I ask clarifying questions to build a bridge to the answer.", e: "Copper" }
            ]
        },
        {
            q: "How do you prefer to receive feedback on your work?",
            options: [
                { t: "Direct and fast so I can improve immediately.", e: "Magnesium" },
                { t: "Specific details on how to refine my methods.", e: "Carbon" },
                { t: "Quietly and privately so I can reflect on it.", e: "Argon" },
                { t: "Through a supportive conversation.", e: "Copper" }
            ]
        }
    ];

    const elementProfiles = {
        Magnesium: {
            icon: "ðŸ”¥", color: "#fbbf24", desc: "The Reactive Dynamo",
            traits: "Like a reactive metal, you bring instant energy and light to any group! You are proactive, bold, and always ready to start the reaction."
        },
        Carbon: {
            icon: "ðŸ’Ž", color: "#10b981", desc: "The Foundation",
            traits: "You are reliable, versatile, and highly organized. Like a diamond, you are strong under pressure and keep the team structured."
        },
        Argon: {
            icon: "â˜ï¸", color: "#8b5cf6", desc: "The Steady State",
            traits: "You are calm, focused, and objective. You provide stability to your group and are excellent at maintaining a clear head during complex tasks."
        },
        Copper: {
            icon: "âš¡", color: "#f97316", desc: "The Conductor",
            traits: "You are an excellent communicator and collaborator. You 'conduct' ideas between people and ensure the team works in harmony."
        }
    };

    let currentStep = 0;
    let studentData = { name: '', class: '', answers: [], result: '' };
    let scores = { Magnesium: 0, Carbon: 0, Argon: 0, Copper: 0 };
    let allSubmissions = [];

    // --- Core Logic ---
    function startQuiz() {
        const name = document.getElementById('student-name').value;
        const cls = document.getElementById('student-class').value;
        if (!name || !cls) { alert("Please enter both your name and class!"); return; }
        studentData.name = name;
        studentData.class = cls;
        document.getElementById('screen-welcome').classList.add('hidden');
        document.getElementById('screen-quiz').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        if (currentStep >= questions.length) { calculateResult(); return; }
        const q = questions[currentStep];
        document.getElementById('question-text').innerText = q.q;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.t;
            btn.onclick = () => { scores[opt.e]++; studentData.answers.push(opt.e); currentStep++; showQuestion(); };
            container.appendChild(btn);
        });
        document.getElementById('progress-fill').style.width = `${(currentStep / questions.length) * 100}%`;
    }

    function calculateResult() {
        document.getElementById('screen-quiz').classList.add('hidden');
        document.getElementById('screen-result').classList.remove('hidden');
        let winner = 'Magnesium';
        let max = 0;
        for (const el in scores) { if (scores[el] > max) { max = scores[el]; winner = el; } }
        studentData.result = winner;
        submitToCloud();
    }

    function submitToCloud() {
        if (!SCRIPT_URL) { setTimeout(() => displayResult(studentData.result), 1500); return; }
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(studentData)
        }).then(() => displayResult(studentData.result)).catch(() => displayResult(studentData.result));
    }

    function displayResult(element) {
        const profile = elementProfiles[element];
        const content = document.getElementById('result-content');
        content.innerHTML = `
            <div class="result-icon">${profile.icon}</div>
            <h1 style="background:none;-webkit-text-fill-color:initial;color:${profile.color}">${element}</h1>
            <h3 style="color:var(--text-muted);margin-top:-10px;">${profile.desc}</h3>
            <p style="color:var(--text);margin-top:20px;">${profile.traits}</p>
        `;
    }

    // --- Teacher Dashboard Logic ---
    function toggleTeacherLogin() {
        const studentView = document.getElementById('student-view');
        const loginView = document.getElementById('teacher-login');
        const dashboardView = document.getElementById('teacher-dashboard');
        
        if (studentView.classList.contains('hidden')) {
            studentView.classList.remove('hidden');
            loginView.classList.add('hidden');
            dashboardView.classList.add('hidden');
        } else {
            studentView.classList.add('hidden');
            loginView.classList.remove('hidden');
        }
    }

    function verifyTeacher() {
        const pass = document.getElementById('admin-pass').value;
        if (pass === 'ilovechemistry') {
            document.getElementById('teacher-login').classList.add('hidden');
            document.getElementById('teacher-dashboard').classList.remove('hidden');
            fetchResults();
        } else {
            alert("Incorrect password.");
        }
    }

    function fetchResults() {
        if (!SCRIPT_URL) { alert("SCRIPT_URL not set in index.html"); return; }
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '<tr><td colspan="3">Syncing...</td></tr>';
        
        fetch(SCRIPT_URL + "?action=read")
            .then(res => res.json())
            .then(data => {
                allSubmissions = data;
                tbody.innerHTML = '';
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${row.name}</td><td>${row.class}</td><td style="color:var(--primary); font-weight:bold;">${row.result}</td>`;
                    tbody.appendChild(tr);
                });
            }).catch(() => { tbody.innerHTML = '<tr><td colspan="3">Error loading data.</td></tr>'; });
    }

    function downloadCSV() {
        if (!allSubmissions.length) return;
        let csv = "Name,Class,Result\n";
        allSubmissions.forEach(r => csv += `"${r.name}","${r.class}","${r.result}"\n`);
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'chemistry_results.csv';
        a.click();
    }
</script>

</body>
</html>
